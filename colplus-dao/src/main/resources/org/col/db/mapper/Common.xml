<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.col.db.mapper.Common">
    <sql id="limit">
        LIMIT #{page.limit} OFFSET #{page.offset}
    </sql>

    <!-- selects the last successful import, i.e. the one that imported data -->
    <sql id="fromFinishedDatasetImport">
        FROM dataset_import
        WHERE dataset_key = #{datasetKey} AND state = 4
        ORDER BY attempt DESC
        LIMIT 1
    </sql>

    <!-- selects the last successful import, i.e. the one that imported data -->
    <sql id="countFromFinishedDatasetImport">
        SELECT coalesce(
            (SELECT ${column} <include refid="org.col.db.mapper.Common.fromFinishedDatasetImport"/>)
        , 0)
    </sql>

</mapper>

